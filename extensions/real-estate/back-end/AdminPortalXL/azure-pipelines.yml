trigger:
  branches:
    include:
      - main
      - releases/real-estate/*
  paths:
    include:
      - extensions/real-estate/back-end/AdminPortalXL/*

pr:
  branches:
    include:
      - main
      - releases/real-estate/*
  paths:
    include:
      - extensions/real-estate/back-end/AdminPortalXL/*

variables:
  - name: buildConfiguration
    value: Release
  - name: majorVersion # This is used to determine keyvault prefix within PrefixKeyVaultSecretManager
    value: 1
  - name: projectPath
    value: extensions/real-estate/back-end/AdminPortalXL
  - name: srcProjectDir
    value: $(projectPath)/src/AdminPortalXL
  - name: testProjectDir
    value: $(projectPath)/test/AdminPortalXL.Test

resources:
  repositories:
    - repository: infrastructure
      type: github
      name: Willowinc/AzurePlatform
      endpoint: github.com_willow-github-svc-Twin Platform

stages:
- stage: Build
  jobs:
  - job: BuildArtifactsJob
    pool:
      vmImage: 'Ubuntu-latest'

    steps:
    - template: ../../../../libraries/scripts/semantic-build-numbers-template.yml
      parameters:
        majorVersion: $(majorVersion)

    - template: ../../../../libraries/scripts/dotnet-build-test-publish.yml
      parameters:
        srcProjectDir: $(srcProjectDir)
        testProjectDir: $(testProjectDir)
        zipAfterPublish: true
        restoreGithubNugetPackages: true
        
    - task: PublishBuildArtifacts@1
