parameters:
- name: srcProjectDir
  type: string
- name: testProjectDir
  type: string
- name: buildConfiguration
  type: string
  default: Release
- name: buildVersion
  type: string
  default: 1.0.0.0
- name: dotnetVersion
  type: string
  default: 7.0.x
- name: preBuildSteps
  type: stepList
  default: []

steps:
- ${{ each step in parameters.preBuildSteps }}:
  - ${{ step }}

- task: UseDotNet@2
  displayName: Use .NET ${{ parameters.dotnetVersion }}
  inputs:
    packageType: 'sdk'
    version: ${{ parameters.dotnetVersion }}

- task: DotNetCoreCLI@2
  displayName: 'Restore nuget packages'
  inputs:
    command: restore
    feedsToUse: config  
    nugetConfigPath: NuGet.Config
    externalFeedCredentials: 'TwinPlatformGitHub'
    projects: |
      ${{ parameters.srcProjectDir }}
      ${{ parameters.testProjectDir }}

- task: DotNetCoreCLI@2
  displayName: 'Build Project for ${{ parameters.buildConfiguration }}'
  inputs:
    command: build
    arguments: '--no-restore --configuration ${{ parameters.buildConfiguration }} /p:Version=${{ parameters.buildVersion }}'
    projects: |
      ${{ parameters.srcProjectDir }}
      ${{ parameters.testProjectDir }}